/*! For license information please see mail.new-message-modal.300be403b0989a9179e1.js.LICENSE.txt */
"use strict";(self.webpackChunknextcloud_mail=self.webpackChunknextcloud_mail||[]).push([[315],{53638:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,'.message-composer[data-v-7aa049b6]{margin:0;z-index:100;display:flex;flex-direction:column;height:100%;max-height:100%}.composer-actions[data-v-7aa049b6]{position:sticky;background:linear-gradient(rgba(255, 255, 255, 0), var(--color-main-background-translucent) 50%)}.composer-fields[data-v-7aa049b6]{display:flex;border-top:1px solid var(--color-border);align-items:flex-start}.composer-fields label[data-v-7aa049b6]{padding:11px 20px 11px 0}.composer-fields[data-v-7aa049b6] .multiselect--multiple .multiselect__tags{display:grid;grid-template-columns:calc(100% - 18px) 18px 100%}.composer-fields[data-v-7aa049b6] .multiselect--multiple .multiselect__tags .multiselect__limit{margin-right:0;margin-left:8px}.composer-fields[data-v-7aa049b6] .multiselect__content-wrapper{border-bottom:1px solid var(--color-border);margin-top:0}.composer-fields[data-v-7aa049b6] .multiselect__content-wrapper li>span::before{display:none}.composer-fields[data-v-7aa049b6] .multiselect__input{position:relative !important;top:0;grid-column-start:1;grid-column-end:3}.composer-fields[data-v-7aa049b6] .multiselect--active input:focus-visible{box-shadow:none}.composer-fields[data-v-7aa049b6] .multiselect__tags{box-sizing:border-box;height:auto}.composer-fields__from[data-v-7aa049b6]{margin-right:102px}.composer-fields .multiselect.multiselect--multiple[data-v-7aa049b6]::after{position:absolute;right:0;top:auto;bottom:8px}.composer-fields .multiselect__tag[data-v-7aa049b6]{position:relative}.composer-fields.mail-account[data-v-7aa049b6]{border-top:none;padding-top:10px}.composer-fields.mail-account>.multiselect[data-v-7aa049b6]{max-width:none;min-height:auto}.composer-fields .multiselect[data-v-7aa049b6],.composer-fields input[data-v-7aa049b6],.composer-fields TextEditor[data-v-7aa049b6]{flex-grow:1;max-width:none;border:none;border-radius:0}.composer-fields .composer-fields--custom[data-v-7aa049b6]{display:flex;align-items:flex-start;flex-wrap:wrap;padding-top:2px;width:calc(100% - 120px)}.composer-fields .composer-fields--custom button[data-v-7aa049b6]{margin-top:0;margin-bottom:0;background-color:rgba(0,0,0,0);border:none;opacity:.5;padding:10px 16px}.composer-fields .composer-fields--custom button.active[data-v-7aa049b6],.composer-fields .composer-fields--custom button[data-v-7aa049b6]:active{opacity:1}.composer-fields .composer-fields--custom .multiselect[data-v-7aa049b6]{width:calc(100% - 150px)}.composer-fields .multiselect[data-v-7aa049b6]{margin-right:12px}.composer-fields .subject[data-v-7aa049b6]{font-size:15px;font-weight:bold;margin:3px 0 !important;padding:0 12px !important}.composer-fields .subject[data-v-7aa049b6]:focus-visible{box-shadow:none !important}.composer-fields .message-body[data-v-7aa049b6]{height:100%;width:100%;margin:0;border:none !important;outline:none !important;box-shadow:none !important;padding:12px;-webkit-user-select:text;user-select:text}.message-editor[data-v-7aa049b6]{flex:1 1 100%;min-height:0}.draft-status[data-v-7aa049b6]{padding:2px;opacity:.5;font-size:small;display:block}.from-label[data-v-7aa049b6],.to-label[data-v-7aa049b6],.copy-toggle[data-v-7aa049b6],.cc-label[data-v-7aa049b6],.bcc-label[data-v-7aa049b6]{padding-top:12px;padding-bottom:12px;padding-right:20px;cursor:text;color:var(--color-text-maxcontrast);width:100px;text-align:right;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:bold}.bcc-label[data-v-7aa049b6]{top:initial;bottom:0}.copy-toggle[data-v-7aa049b6]{cursor:pointer;width:initial}.copy-toggle[data-v-7aa049b6]:hover,.copy-toggle[data-v-7aa049b6]:focus{color:var(--color-main-text)}.reply[data-v-7aa049b6]{min-height:100px}[data-v-7aa049b6] .multiselect .multiselect__tags,[data-v-7aa049b6] .vs__dropdown-toggle,[data-v-7aa049b6] .vs__dropdown-menu,.subject[data-v-7aa049b6]{border:none !important}[data-v-7aa049b6] [data-select="create"] .avatardiv--unknown{background:var(--color-text-maxcontrast) !important}[data-v-7aa049b6] .multiselect.opened .multiselect__tags .multiselect__tags-wrap{flex-wrap:wrap}#from[data-v-7aa049b6]{width:100%;cursor:pointer}[data-v-7aa049b6] .vs__actions{display:none}[data-v-7aa049b6] .vs__dropdown-menu{border:1px solid var(--color-border) !important;padding:0 !important;border-radius:0 !important}[data-v-7aa049b6] .vs__dropdown-option{border-radius:0 !important}.submit-message.send.primary.icon-confirm-white[data-v-7aa049b6]{color:var(--color-main-background)}.button[data-v-7aa049b6]{background-color:rgba(0,0,0,0);border:none}.send-button[data-v-7aa049b6]{display:flex;align-items:center;padding:10px 15px;margin-left:5px}.send-button .send-icon[data-v-7aa049b6]{padding-right:5px}.centered-content[data-v-7aa049b6]{margin-top:0 !important}.composer-actions-right[data-v-7aa049b6]{display:flex;align-items:center;flex-direction:row;justify-content:space-between;bottom:5px}.composer-actions--primary-actions[data-v-7aa049b6]{display:flex;flex-direction:row;padding-left:10px;align-items:center}.composer-actions--secondary-actions[data-v-7aa049b6]{display:flex;flex-direction:row;padding:12px;gap:5px}.composer-actions--primary-actions .button[data-v-7aa049b6]{padding:2px}.composer-actions--secondary-actions .button[data-v-7aa049b6]{flex-shrink:0}.composer-actions-draft-status[data-v-7aa049b6]{padding-left:10px}@media only screen and (max-width: 580px){.composer-actions-right[data-v-7aa049b6]{align-items:end;flex-direction:column-reverse}.composer-actions-draft-status[data-v-7aa049b6]{text-align:end;padding-right:15px}.composer-actions--primary-actions[data-v-7aa049b6]{padding-right:5px}}',"",{version:3,sources:["webpack://./src/components/Composer.vue"],names:[],mappings:"AACA,mCACC,QAAA,CACA,WAAA,CACA,YAAA,CACA,qBAAA,CACA,WAAA,CACA,eAAA,CAGD,mCACC,eAAA,CACA,gGAAA,CAGD,kCACC,YAAA,CACA,wCAAA,CACA,sBAAA,CAEA,wCACC,wBAAA,CAGD,4EACC,YAAA,CACA,iDAAA,CAEA,gGACC,cAAA,CACA,eAAA,CAIF,gEACC,2CAAA,CACA,YAAA,CAEA,gFACC,YAAA,CAIF,sDACC,4BAAA,CACA,KAAA,CACA,mBAAA,CACA,iBAAA,CAGD,2EACC,eAAA,CAGD,qDACC,qBAAA,CACA,WAAA,CAGD,wCACC,kBAAA,CAGD,4EACC,iBAAA,CACA,OAAA,CACA,QAAA,CACA,UAAA,CAGD,oDACC,iBAAA,CAGD,+CACC,eAAA,CACA,gBAAA,CAEA,4DACC,cAAA,CACA,eAAA,CAIF,oIAGC,WAAA,CACA,cAAA,CACA,WAAA,CACA,eAAA,CAGD,2DACC,YAAA,CACA,sBAAA,CACA,cAAA,CACA,eAAA,CACA,wBAAA,CAEA,kEACC,YAAA,CACA,eAAA,CACA,8BAAA,CACA,WAAA,CACA,UAAA,CACA,iBAAA,CAGD,kJACC,SAAA,CAGD,wEACC,wBAAA,CAIF,+CACC,iBAAA,CAGD,2CACC,cAAA,CACA,gBAAA,CACA,uBAAA,CACA,yBAAA,CAEA,yDACC,0BAAA,CAIF,gDACC,WAAA,CACA,UAAA,CACA,QAAA,CACA,sBAAA,CACA,uBAAA,CACA,0BAAA,CACA,YAAA,CAIA,wBAAA,CACA,gBAAA,CAKF,iCACC,aAAA,CACA,YAAA,CAGD,+BACC,WAAA,CACA,UAAA,CACA,eAAA,CACA,aAAA,CAGD,6IAKC,gBAAA,CACA,mBAAA,CACA,kBAAA,CACA,WAAA,CACA,mCAAA,CACA,WAAA,CACA,gBAAA,CACA,kBAAA,CACA,eAAA,CACA,sBAAA,CACA,gBAAA,CAGD,4BACC,WAAA,CACA,QAAA,CAGD,8BACC,cAAA,CACA,aAAA,CAEA,wEAEC,4BAAA,CAIF,wBACC,gBAAA,CAGD,wJACC,sBAAA,CAED,6DACC,mDAAA,CAED,iFACC,cAAA,CAGD,uBACC,UAAA,CACA,cAAA,CAED,+BACC,YAAA,CAGD,qCACC,+CAAA,CACA,oBAAA,CACA,0BAAA,CAGD,uCACC,0BAAA,CAED,iEACC,kCAAA,CAED,yBACC,8BAAA,CACA,WAAA,CAED,8BACC,YAAA,CACA,kBAAA,CACA,iBAAA,CACA,eAAA,CAED,yCACC,iBAAA,CAED,mCACC,uBAAA,CAED,yCACC,YAAA,CACA,kBAAA,CACA,kBAAA,CACA,6BAAA,CACA,UAAA,CAED,oDACC,YAAA,CACA,kBAAA,CACA,iBAAA,CACA,kBAAA,CAED,sDACC,YAAA,CACA,kBAAA,CACA,YAAA,CACA,OAAA,CAED,4DACC,WAAA,CAED,8DACC,aAAA,CAGD,gDACC,iBAAA,CAGD,0CACC,yCACC,eAAA,CACA,6BAAA,CAED,gDACC,cAAA,CACA,kBAAA,CAED,oDACC,iBAAA,CAAA",sourcesContent:['\n.message-composer {\n\tmargin: 0;\n\tz-index: 100;\n\tdisplay: flex;\n\tflex-direction: column;\n\theight: 100%;\n\tmax-height: 100%;\n}\n\n.composer-actions {\n\tposition: sticky;\n\tbackground: linear-gradient(rgba(255, 255, 255, 0), var(--color-main-background-translucent) 50%);\n}\n\n.composer-fields {\n\tdisplay: flex;\n\tborder-top: 1px solid var(--color-border);\n\talign-items: flex-start;\n\n\tlabel {\n\t\tpadding: 11px 20px 11px 0;\n\t}\n\n\t:deep(.multiselect--multiple .multiselect__tags) {\n\t\tdisplay: grid;\n\t\tgrid-template-columns: calc(100% - 18px) 18px 100%;\n\n\t\t.multiselect__limit {\n\t\t\tmargin-right: 0;\n\t\t\tmargin-left: 8px\n\t\t}\n\t}\n\n\t:deep(.multiselect__content-wrapper) {\n\t\tborder-bottom: 1px solid var(--color-border);\n\t\tmargin-top: 0;\n\n\t\t& li > span::before {\n\t\t\tdisplay: none\n\t\t}\n\t}\n\n\t:deep(.multiselect__input) {\n\t\tposition: relative !important;\n\t\ttop: 0;\n\t\tgrid-column-start: 1;\n\t\tgrid-column-end: 3;\n\t}\n\n\t:deep(.multiselect--active input:focus-visible) {\n\t\tbox-shadow: none;\n\t}\n\n\t:deep(.multiselect__tags) {\n\t\tbox-sizing: border-box;\n\t\theight: auto;\n\t}\n\n\t&__from {\n\t\tmargin-right: 102px; /* for the modal close and minimize buttons */\n\t}\n\n\t.multiselect.multiselect--multiple::after {\n\t\tposition: absolute;\n\t\tright: 0;\n\t\ttop: auto;\n\t\tbottom: 8px\n\t}\n\n\t.multiselect__tag {\n\t\tposition: relative;\n\t}\n\n\t&.mail-account {\n\t\tborder-top: none;\n\t\tpadding-top: 10px;\n\n\t\t& > .multiselect {\n\t\t\tmax-width: none;\n\t\t\tmin-height: auto;\n\t\t}\n\t}\n\n\t.multiselect,\n\tinput,\n\tTextEditor {\n\t\tflex-grow: 1;\n\t\tmax-width: none;\n\t\tborder: none;\n\t\tborder-radius: 0;\n\t}\n\n\t.composer-fields--custom {\n\t\tdisplay: flex;\n\t\talign-items: flex-start;\n\t\tflex-wrap: wrap;\n\t\tpadding-top: 2px;\n\t\twidth: calc(100% - 120px);\n\n\t\tbutton {\n\t\t\tmargin-top: 0;\n\t\t\tmargin-bottom: 0;\n\t\t\tbackground-color: transparent;\n\t\t\tborder: none;\n\t\t\topacity: 0.5;\n\t\t\tpadding: 10px 16px;\n\t\t}\n\n\t\tbutton.active, button:active {\n\t\t\topacity: 1;\n\t\t}\n\n\t\t.multiselect {\n\t\t\twidth: calc(100% - 150px);\n\t\t}\n\t}\n\n\t.multiselect {\n\t\tmargin-right: 12px;\n\t}\n\n\t.subject {\n\t\tfont-size: 15px;\n\t\tfont-weight: bold;\n\t\tmargin: 3px 0 !important;\n\t\tpadding: 0 12px !important;\n\n\t\t&:focus-visible {\n\t\t\tbox-shadow: none !important;\n\t\t}\n\t}\n\n\t.message-body {\n\t\theight: 100%;\n\t\twidth: 100%;\n\t\tmargin: 0;\n\t\tborder: none !important;\n\t\toutline: none !important;\n\t\tbox-shadow: none !important;\n\t\tpadding: 12px;\n\n\t\t// Fix contenteditable not becoming focused upon clichint within it\'s\n\t\t// boundaries in safari\n\t\t-webkit-user-select: text;\n\t\tuser-select: text;\n\t}\n}\n\n// Make composer editor expand\n.message-editor {\n\tflex: 1 1 100%;\n\tmin-height: 0;\n}\n\n.draft-status {\n\tpadding: 2px;\n\topacity: 0.5;\n\tfont-size: small;\n\tdisplay: block;\n}\n\n.from-label,\n.to-label,\n.copy-toggle,\n.cc-label,\n.bcc-label {\n\tpadding-top: 12px;\n\tpadding-bottom: 12px;\n\tpadding-right: 20px;\n\tcursor: text;\n\tcolor: var(--color-text-maxcontrast);\n\twidth: 100px;\n\ttext-align: right;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tfont-weight: bold;\n}\n\n.bcc-label {\n\ttop: initial;\n\tbottom: 0;\n}\n\n.copy-toggle {\n\tcursor: pointer;\n\twidth: initial;\n\n\t&:hover,\n\t&:focus {\n\t\tcolor: var(--color-main-text);\n\t}\n}\n\n.reply {\n\tmin-height: 100px;\n}\n\n:deep(.multiselect .multiselect__tags),:deep( .vs__dropdown-toggle),:deep(.vs__dropdown-menu),  .subject {\n\tborder: none !important;\n}\n:deep([data-select="create"] .avatardiv--unknown) {\n\tbackground: var(--color-text-maxcontrast) !important;\n}\n:deep(.multiselect.opened .multiselect__tags .multiselect__tags-wrap) {\n\tflex-wrap: wrap;\n}\n\n#from{\n\twidth: 100%;\n\tcursor: pointer;\n}\n:deep(.vs__actions){\n\tdisplay: none;\n}\n\n:deep(.vs__dropdown-menu){\n\tborder: 1px solid var(--color-border) !important;\n\tpadding: 0 !important;\n\tborder-radius: 0  !important;\n}\n\n:deep(.vs__dropdown-option){\n\tborder-radius: 0  !important;\n}\n.submit-message.send.primary.icon-confirm-white {\n\tcolor: var(--color-main-background);\n}\n.button {\n\tbackground-color: transparent;\n\tborder: none;\n}\n.send-button {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 10px 15px;\n\tmargin-left: 5px;\n}\n.send-button .send-icon {\n\tpadding-right: 5px;\n}\n.centered-content {\n\tmargin-top: 0 !important;\n}\n.composer-actions-right {\n\tdisplay: flex;\n\talign-items: center;\n\tflex-direction: row;\n\tjustify-content: space-between;\n\tbottom: 5px;\n}\n.composer-actions--primary-actions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tpadding-left: 10px;\n\talign-items: center;\n}\n.composer-actions--secondary-actions {\n\tdisplay: flex;\n\tflex-direction: row;\n\tpadding: 12px;\n\tgap: 5px;\n}\n.composer-actions--primary-actions .button {\n\tpadding: 2px;\n}\n.composer-actions--secondary-actions .button{\n\tflex-shrink: 0;\n}\n\n.composer-actions-draft-status {\n\tpadding-left: 10px;\n}\n\n@media only screen and (max-width: 580px) {\n\t.composer-actions-right {\n\t\talign-items: end;\n\t\tflex-direction: column-reverse;\n\t}\n\t.composer-actions-draft-status {\n\t\ttext-align: end;\n\t\tpadding-right: 15px;\n\t}\n\t.composer-actions--primary-actions {\n\t\tpadding-right: 5px;\n\t}\n}\n\n'],sourceRoot:""}]);const r=s},68912:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,".composer-attachment[data-v-15a01d54]{width:calc(50% - 20px);box-sizing:border-box;display:flex;justify-content:space-between;align-items:flex-start;margin:10px;flex-wrap:wrap}.composer-attachment--with-error[data-v-15a01d54]{color:red;opacity:.5}.composer-attachment .cloud-attachment-icon[data-v-15a01d54]{position:absolute;z-index:2;right:2px;top:2px;color:#000}.composer-attachment .attachment-preview[data-v-15a01d54]{display:inline-flex;flex-wrap:wrap;width:50px;height:50px;overflow:hidden;border-radius:3px;align-items:center;justify-content:center;position:relative}.composer-attachment .attachment-preview img[data-v-15a01d54]{display:block;min-width:50px;min-height:50px;max-width:72px;max-height:72px;position:absolute}.composer-attachment .attachment-preview span[data-v-15a01d54]{color:rgba(0,0,0,.3);font-size:13px;text-transform:uppercase;font-weight:bold}.composer-attachment button[data-v-15a01d54]{padding:0;background:rgba(0,0,0,0);border:none;margin:6px -2px 0 0}.attachments-upload-progress[data-v-15a01d54]{display:block;height:5px;width:100%;position:relative;border-radius:5px;background:var(--color-background-dark);margin-top:7px}.attachments-upload-progress .attachments-upload-progress--bar[data-v-15a01d54]{height:5px;background:var(--color-primary-element-light);position:absolute;z-index:1;left:0;border-radius:5px}.attachments-upload-progress>div[data-v-15a01d54]{padding-left:3px}.new-message-attachments-action[data-v-15a01d54]{display:inline-block;vertical-align:middle;padding:18px;opacity:.5}.attachment-inner[data-v-15a01d54]{display:flex;flex-wrap:wrap;width:calc(100% - 90px);position:relative}.new-message-attachment-name[data-v-15a01d54]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap;margin-bottom:3px}.new-message-attachment-size[data-v-15a01d54]{color:#6a6a6a;width:100%}.new-message-attachment-name.upload-ongoing[data-v-15a01d54]{color:#0082c9}.new-message-attachment-name.upload-warning[data-v-15a01d54]{color:#d2322d}.new-message-attachment-name.upload-warning .ui-progressbar-value[data-v-15a01d54]{border:1px solid #e9322d;background:#e9322d}","",{version:3,sources:["webpack://./src/components/ComposerAttachment.vue"],names:[],mappings:"AAEA,sCACC,sBAAA,CACG,qBAAA,CACA,YAAA,CACA,6BAAA,CACA,sBAAA,CACA,WAAA,CACA,cAAA,CAEH,kDACC,SAAA,CACA,UAAA,CAGD,6DACC,iBAAA,CACA,SAAA,CACA,SAAA,CACA,OAAA,CACA,UAAA,CAGD,0DACC,mBAAA,CACA,cAAA,CACA,UAAA,CACA,WAAA,CACA,eAAA,CACA,iBAAA,CACA,kBAAA,CACA,sBAAA,CACA,iBAAA,CAEA,8DACC,aAAA,CACA,cAAA,CACA,eAAA,CACA,cAAA,CACA,eAAA,CACA,iBAAA,CAGD,+DACC,oBAAA,CACA,cAAA,CACA,wBAAA,CACA,gBAAA,CAKF,6CACC,SAAA,CACA,wBAAA,CACA,WAAA,CACA,mBAAA,CAIF,8CACC,aAAA,CACA,UAAA,CACA,UAAA,CACA,iBAAA,CACA,iBAAA,CACA,uCAAA,CACA,cAAA,CAEA,gFACC,UAAA,CACA,6CAAA,CACA,iBAAA,CACA,SAAA,CACA,MAAA,CACA,iBAAA,CAIF,kDACC,gBAAA,CAGD,iDACC,oBAAA,CACA,qBAAA,CACA,YAAA,CACA,UAAA,CAGD,mCACC,YAAA,CACG,cAAA,CACH,uBAAA,CACA,iBAAA,CAKD,8CACC,sBAAA,CACA,eAAA,CACA,kBAAA,CACA,iBAAA,CAGD,8CACC,aAAA,CACA,UAAA,CAID,6DACC,aAAA,CAID,6DACC,aAAA,CAID,mFACC,wBAAA,CACA,kBAAA",sourcesContent:["\n\n.composer-attachment {\n\twidth: calc(50% - 20px);\n    box-sizing: border-box;\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-start;\n    margin: 10px;\n    flex-wrap: wrap;\n\n\t&--with-error {\n\t\tcolor:red;\n\t\topacity: 0.5;\n\t}\n\n\t.cloud-attachment-icon {\n\t\tposition:absolute;\n\t\tz-index: 2;\n\t\tright: 2px;\n\t\ttop: 2px;\n\t\tcolor: rgba(0, 0, 0, 1);\n\t}\n\n\t.attachment-preview {\n\t\tdisplay: inline-flex;\n\t\tflex-wrap: wrap;\n\t\twidth: 50px;\n\t\theight:50px;\n\t\toverflow: hidden;\n\t\tborder-radius: 3px;\n\t\talign-items: center;\n\t\tjustify-content: center;\n\t\tposition: relative;\n\n\t\timg {\n\t\t\tdisplay: block;\n\t\t\tmin-width: 50px;\n\t\t\tmin-height: 50px;\n\t\t\tmax-width: 72px;\n\t\t\tmax-height: 72px;\n\t\t\tposition: absolute;\n\t\t}\n\n\t\tspan {\n\t\t\tcolor: rgba(0,0,0,0.3);\n\t\t\tfont-size: 13px;\n\t\t\ttext-transform: uppercase;\n\t\t\tfont-weight: bold;\n\t\t}\n\n\t}\n\n\tbutton {\n\t\tpadding: 0;\n\t\tbackground: transparent;\n\t\tborder: none;\n\t\tmargin: 6px -2px 0 0;\n\t}\n}\n\n.attachments-upload-progress {\n\tdisplay: block;\n\theight: 5px;\n\twidth: 100%;\n\tposition: relative;\n\tborder-radius: 5px;\n\tbackground: var(--color-background-dark);\n\tmargin-top: 7px;\n\n\t.attachments-upload-progress--bar {\n\t\theight: 5px;\n\t\tbackground: var(--color-primary-element-light);\n\t\tposition: absolute;\n\t\tz-index: 1;\n\t\tleft: 0;\n\t\tborder-radius: 5px;\n\t}\n}\n\n.attachments-upload-progress > div {\n\tpadding-left: 3px;\n}\n\n.new-message-attachments-action {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tpadding: 18px;\n\topacity: 0.5;\n}\n\n.attachment-inner {\n\tdisplay: flex;\n    flex-wrap: wrap;\n\twidth: calc(100% - 90px);\n\tposition: relative;\n\n}\n\n/* attachment filenames */\n.new-message-attachment-name {\n\ttext-overflow: ellipsis;\n\toverflow: hidden;\n\twhite-space:nowrap;\n\tmargin-bottom: 3px;\n}\n\n.new-message-attachment-size {\n\tcolor: #6a6a6a;\n\twidth: 100%;\n}\n\n/* Colour the filename with a different color during attachment upload */\n.new-message-attachment-name.upload-ongoing {\n\tcolor: #0082c9;\n}\n\n/* Colour the filename in red if the attachment upload failed */\n.new-message-attachment-name.upload-warning {\n\tcolor: #d2322d;\n}\n\n/* Red ProgressBar for failed attachment uploads */\n.new-message-attachment-name.upload-warning .ui-progressbar-value {\n\tborder: 1px solid #e9322d;\n\tbackground: #e9322d;\n}\n"],sourceRoot:""}]);const r=s},2002:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,".new-message-attachments--counter[data-v-201da0a4]{color:var(--color-text-maxcontrast);padding:10px 20px;cursor:pointer;display:flex;align-items:center}.new-message-attachments--counter--with-errors[data-v-201da0a4]{color:red}.new-message-attachments--list[data-v-201da0a4]{display:flex;flex-wrap:wrap;overflow:auto;transition:max-height .5s cubic-bezier(0, 1, 0, 1);padding:0 10px}.new-message-attachments--list.hide[data-v-201da0a4]{overflow:hidden;max-height:0;transition:max-height .5s cubic-bezier(0, 1, 0, 1)}.new-message-attachments--list.active[data-v-201da0a4]{overflow:auto;max-height:287px}","",{version:3,sources:["webpack://./src/components/ComposerAttachments.vue"],names:[],mappings:"AAGC,mDACC,mCAAA,CACA,iBAAA,CACA,cAAA,CACA,YAAA,CACA,kBAAA,CAEA,gEACC,SAAA,CAIF,gDACC,YAAA,CACA,cAAA,CAEA,aAAA,CACA,kDAAA,CACA,cAAA,CAEA,qDACC,eAAA,CACA,YAAA,CACA,kDAAA,CAGD,uDACC,aAAA,CACA,gBAAA",sourcesContent:["\n\n.new-message-attachments {\n\t&--counter {\n\t\tcolor: var(--color-text-maxcontrast);\n\t\tpadding: 10px 20px;\n\t\tcursor:pointer;\n\t\tdisplay:flex;\n\t\talign-items: center;\n\n\t\t&--with-errors {\n\t\t\tcolor:red;\n\t\t}\n\t}\n\n\t&--list {\n\t\tdisplay: flex;\n\t\tflex-wrap: wrap;\n\t\t// 2 and a half attachment height\n\t\toverflow: auto;\n\t\ttransition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n\t\tpadding: 0 10px;\n\n\t\t&.hide {\n\t\t\toverflow: hidden;\n\t\t\tmax-height:0;\n\t\t\ttransition: max-height 0.5s cubic-bezier(0, 1, 0, 1);\n\t\t}\n\n\t\t&.active {\n\t\t\toverflow: auto;\n\t\t\tmax-height: 287px;\n\t\t}\n\t}\n}\n"],sourceRoot:""}]);const r=s},43434:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,"@media only screen and (max-width: 600px){[data-v-5b0b7460] .modal-container{max-width:80%}}[data-v-5b0b7460] .modal-wrapper .modal-container{overflow-y:auto !important;overflow-x:auto !important;height:90%;max-height:700px !important}.minimize-button[data-v-5b0b7460]{position:absolute;right:49px;top:4px}","",{version:3,sources:["webpack://./src/components/NewMessageModal.vue"],names:[],mappings:"AACA,0CACC,mCACC,aAAA,CAAA,CAGF,kDACC,0BAAA,CACA,0BAAA,CAEA,UAAA,CAEA,2BAAA,CAGD,kCACC,iBAAA,CACA,UAAA,CACA,OAAA",sourcesContent:["\n@media only screen and (max-width: 600px) {\n\t:deep(.modal-container) {\n\t\tmax-width: 80%;\n\t}\n}\n:deep(.modal-wrapper .modal-container) {\n\toverflow-y: auto !important;\n\toverflow-x: auto !important;\n\t// from original Modal max-height\n\theight: 90%;\n\t// Max editor + modal height\n\tmax-height: 700px !important;\n}\n\n.minimize-button {\n\tposition: absolute;\n\tright: 49px;\n\ttop: 4px;\n}\n"],sourceRoot:""}]);const r=s},7479:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,".multiselect .multiselect__tags .multiselect__tags-wrap .multiselect__tag--recipient[data-v-3b5528ea]{padding:0;border-radius:25px;border-color:rgba(0,0,0,0);background-color:var(--color-background-dark);height:24px}.multiselect .multiselect__tags .multiselect__tags-wrap .multiselect__tag--recipient>span.option[data-v-3b5528ea]{margin-left:0}.multiselect__tag--recipient .action-item--single[data-v-3b5528ea]{width:auto;min-width:24px;height:24px;position:absolute;right:-7px}.multiselect__tag--recipient .action-item--single .material-design-icon[data-v-3b5528ea]{height:24px;width:24px}.delete-recipient[data-v-3b5528ea]{display:inline-flex;align-items:center;justify-content:center;cursor:pointer;height:24px;width:24px;min-width:24px;margin-left:6px;border-radius:50%}.delete-recipient[data-v-3b5528ea]:hover{background:var(--color-background-darker)}[data-v-3b5528ea] .option{margin-left:10px}","",{version:3,sources:["webpack://./src/components/RecipientListItem.vue"],names:[],mappings:"AACA,sGAIC,SAAA,CACA,kBAAA,CACA,0BAAA,CACA,6CAAA,CACA,WAAA,CAEA,kHACC,aAAA,CAGF,mEACC,UAAA,CACA,cAAA,CACA,WAAA,CACA,iBAAA,CACA,UAAA,CAED,yFACC,WAAA,CACA,UAAA,CAED,mCACC,mBAAA,CACA,kBAAA,CACA,sBAAA,CACA,cAAA,CACA,WAAA,CACA,UAAA,CACA,cAAA,CACA,eAAA,CACA,iBAAA,CAEA,yCACC,yCAAA,CAGF,0BACC,gBAAA",sourcesContent:["\n.multiselect\n\t.multiselect__tags\n\t.multiselect__tags-wrap\n\t.multiselect__tag--recipient {\n\tpadding: 0;\n\tborder-radius: 25px;\n\tborder-color: transparent;\n\tbackground-color: var(--color-background-dark);\n\theight: 24px;\n\n\t& > span.option {\n\t\tmargin-left: 0\n\t}\n}\n.multiselect__tag--recipient .action-item--single {\n\twidth: auto;\n\tmin-width: 24px;\n\theight: 24px;\n\tposition: absolute;\n\tright: -7px;\n}\n.multiselect__tag--recipient .action-item--single .material-design-icon {\n\theight: 24px;\n\twidth: 24px;\n}\n.delete-recipient {\n\tdisplay: inline-flex;\n\talign-items: center;\n\tjustify-content: center;\n\tcursor: pointer;\n\theight: 24px;\n\twidth: 24px;\n\tmin-width: 24px;\n\tmargin-left: 6px;\n\tborder-radius: 50%;\n\n\t&:hover {\n\t\tbackground: var(--color-background-darker);\n\t}\n}\n:deep(.option) {\n\tmargin-left: 10px;\n}\n"],sourceRoot:""}]);const r=s},6885:(t,e,a)=>{a.d(e,{Z:()=>r});var n=a(87537),i=a.n(n),o=a(23645),s=a.n(o)()(i());s.push([t.id,"\n#mailvelope-composer[data-v-695d8526] {\n\twidth: 100%;\n\theight: 450px;\n}\n","",{version:3,sources:["webpack://./src/components/MailvelopeEditor.vue"],names:[],mappings:";AA6EA;CACA,WAAA;CACA,aAAA;AACA",sourcesContent:["\x3c!--\n  - @copyright 2020 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @author 2020 Christoph Wurst <christoph@winzerhof-wurst.at>\n  -\n  - @license AGPL-3.0-or-later\n  -\n  - This program is free software: you can redistribute it and/or modify\n  - it under the terms of the GNU Affero General Public License as\n  - published by the Free Software Foundation, either version 3 of the\n  - License, or (at your option) any later version.\n  -\n  - This program is distributed in the hope that it will be useful,\n  - but WITHOUT ANY WARRANTY; without even the implied warranty of\n  - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n  - GNU Affero General Public License for more details.\n  -\n  - You should have received a copy of the GNU Affero General Public License\n  - along with this program.  If not, see <http://www.gnu.org/licenses/>.\n  --\x3e\n\n<template>\n\t<div id=\"mailvelope-composer\" />\n</template>\n\n<script>\nimport logger from '../logger.js'\nimport { isPgpgMessage } from '../crypto/pgp.js'\n\nexport default {\n\tname: 'MailvelopeEditor',\n\tprops: {\n\t\tvalue: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\trecipients: {\n\t\t\ttype: Array,\n\t\t\trequired: true,\n\t\t},\n\t\tquotedText: {\n\t\t\ttype: Object,\n\t\t\trequired: false,\n\t\t\tdefault: () => undefined,\n\t\t},\n\t\tisReplyOrForward: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\tdata() {\n\t\treturn {\n\t\t\teditor: undefined,\n\t\t}\n\t},\n\tasync mounted() {\n\t\tconst isEncrypted = this.quotedText ? isPgpgMessage(this.quotedText) : false\n\t\tconst quotedMail = this.isReplyOrForward ? this.quotedText?.value : undefined\n\n\t\tthis.editor = await window.mailvelope.createEditorContainer('#mailvelope-composer', undefined, {\n\t\t\tquotedMail: isEncrypted ? quotedMail : undefined,\n\t\t})\n\t},\n\tmethods: {\n\t\tasync pull() {\n\t\t\tconst recipients = this.recipients.map((r) => r.email)\n\t\t\tlogger.info('encrypting message', { recipients })\n\t\t\tconst armored = await this.editor.encrypt(recipients)\n\t\t\tlogger.info('message encryted', { armored })\n\n\t\t\tthis.$emit('input', armored)\n\t\t},\n\t},\n}\n<\/script>\n\n<style scoped>\n#mailvelope-composer {\n\twidth: 100%;\n\theight: 450px;\n}\n</style>\n"],sourceRoot:""}]);const r=s},60399:(e,a,n)=>{n.r(a),n.d(a,{default:()=>Xt});var i=n(15961),o=n(64024),s=n(31352),r=n(89177),c=n(61189),l=n(76810),d=n.n(l),m=n(83049),A=n.n(m),p=n(45668),h=n.n(p),u=n(59197),g=n(69496),C=n.n(g),f=n(61462),v=n(76188),b=n(88846),y=n.n(b),w=n(77958),x=n(3378),_=n(76059),D=n.n(_),k=n(37667),S=n.n(k),B=n(20144),M=n(85757);async function I(t){var e;const a=await(0,M.s)("files").stat(t,{data:'<?xml version="1.0"?>\n\t\t\t<d:propfind\n\t\t\txmlns:d="DAV:"\n\t\t\txmlns:oc="http://owncloud.org/ns"\n\t\t\txmlns:nc="http://nextcloud.org/ns">\n\t\t\t\t<d:prop>\n\t\t\t\t\t<oc:size />\n\t\t\t\t\t<oc:fileid />\n\t\t\t\t\t<nc:has-preview />\n\t\t\t\t</d:prop>\n\t\t\t</d:propfind>',details:!0});return null==a||null===(e=a.data)||void 0===e?void 0:e.props}var T=n(93664),E=n(79753),L=n(80413),R=n(44893),z=n(17113),P=n(40069);const F={name:"ComposerAttachment",components:{Close:R.default,Cloud:z.Z,EmailArrowRightOutlineIcon:P.Z},props:{bus:{type:Object,required:!0},attachment:{type:Object,required:!0},uploading:{type:Boolean,default:!1}},data:()=>({progress:0,sizeString:"",finished:!1}),computed:{previewURL(){return this.attachment.hasPreview&&this.attachment.id>0?(0,E.generateUrl)("/core/preview?fileId=".concat(this.attachment.id,"&x=100&y=100&a=0")):""},getIcon(){return OC.MimeType.getIconUrl(this.attachment.fileType)},extension(){return this.attachment.fileName.split(".").pop()}},methods:{onDelete(t){this.$emit("on-delete-attachment",t)}}};var $=n(93379),N=n.n($),Z=n(7795),O=n.n(Z),U=n(90569),G=n.n(U),V=n(3565),j=n.n(V),q=n(19216),W=n.n(q),Y=n(44589),H=n.n(Y),K=n(68912),Q={};Q.styleTagTransform=H(),Q.setAttributes=j(),Q.insert=G().bind(null,"head"),Q.domAPI=O(),Q.insertStyleElement=W(),N()(K.Z,Q),K.Z&&K.Z.locals&&K.Z.locals;var X=n(51900);const J=(0,X.Z)(F,(function(){var t=this,e=t._self._c;return e("li",{staticClass:"composer-attachment",class:{"composer-attachment--with-error":t.attachment.error}},[e("div",{staticClass:"attachment-preview"},[!1!==t.attachment.imageBlobURL?e("img",{staticClass:"attachment-preview-image",attrs:{src:t.attachment.imageBlobURL}}):t.attachment.hasPreview?e("img",{staticClass:"attachment-preview-image",attrs:{src:t.previewURL}}):e("img",{staticClass:"attachment-preview-image",attrs:{src:t.getIcon}}),t._v(" "),"cloud"===t.attachment.type?e("span",{staticClass:"cloud-attachment-icon"},[e("Cloud",{attrs:{size:16}})],1):"message"===t.attachment.type?e("span",[e("EmailArrowRightOutlineIcon")],1):t._e()]),t._v(" "),e("div",{staticClass:"attachment-inner"},[e("span",{staticClass:"new-message-attachment-name"},[t._v("\n\t\t\t"+t._s(t.attachment.displayName?t.attachment.displayName:t.attachment.fileName)+"\n\t\t")]),t._v(" "),t.attachment.finished?t.attachment.sizeString?e("span",{staticClass:"new-message-attachment-size"},[t._v("\n\t\t\t"+t._s(t.attachment.sizeString)+"\n\t\t")]):t._e():e("span",{staticClass:"attachments-upload-progress"},[e("span",{staticClass:"attachments-upload-progress--bar",style:"width:"+t.attachment.percent+"%"})])]),t._v(" "),e("button",{on:{click:function(e){return t.onDelete(t.attachment)}}},[e("Close",{attrs:{size:24}})],1)])}),[],!1,null,"15a01d54",null).exports;var tt=n(98318),et=n(52386);const at=["image/gif","image/jpeg","image/pjpeg","image/png","image/webp"],nt={name:"ComposerAttachments",components:{ComposerAttachment:J,ChevronDown:tt.default,ChevronUp:et.default},props:{value:{type:Array,required:!0},bus:{type:Object,required:!0},uploadSizeLimit:{type:Number,default:0}},data:()=>({uploading:!1,uploads:{},attachments:[],isToggle:!1,hasNextLine:!1}),computed:{hasAttachmentErrors(){return this.attachments.some((t=>t.error))},uploadProgress(){let t=0,e=0;for(const a in this.uploads)t+=this.uploads[a].uploaded,e+=this.uploads[a].total;return(t/e*100).toFixed(1)},total(){let t=0;for(const e in this.uploads)t+=this.uploads[e].total;return t}},watch:{attachments(){this.$nextTick((function(){let t=null;this.$refs.attachments.some(((e,a)=>{const n=e.$el.getBoundingClientRect().top;return null!==t&&t!==n?(this.hasNextLine||(this.isToggle=!0,this.hasNextLine=!0),!0):(t=n,this.$refs.attachments.length===a+1&&(this.hasNextLine=!1,this.isToggle=!1,!0))}))}))}},created(){this.bus.$on("on-add-local-attachment",this.onAddLocalAttachment),this.bus.$on("on-add-cloud-attachment",this.onAddCloudAttachment),this.bus.$on("on-add-cloud-attachment-link",this.onAddCloudAttachmentLink),this.bus.$on("on-add-message-as-attachment",this.onAddMessageAsAttachment),this.value.map((t=>(this.attachments.push({id:t.id,fileName:t.fileName,displayName:h()("/",t.fileName),total:t.size,finished:!0,sizeString:this.formatBytes(t.size),imageBlobURL:t.isImage?t.downloadUrl:t.mimeUrl}),t)))},methods:{onAddLocalAttachment(){this.$refs.localAttachments.click()},emitNewAttachments(t){this.$emit("input",this.value.concat(t))},totalSizeOfUpload(){return Object.values(this.value).reduce(((t,e)=>"local"===!e.type?t:t+e.size),0)},onLocalAttachmentSelected(t){this.uploading=!0,B.ZP.set(this,"uploads",{});const e=S()(D()("size"),Object.values(t.target.files)),a=e+this.totalSizeOfUpload();if(r.Z.debug("checking upload size limit",{existingUploads:this.totalSizeOfUpload(),toUpload:e,limit:this.uploadSizeLimit,newTotal:a}),this.uploadSizeLimit&&a>this.uploadSizeLimit)return this.showAttachmentFileSizeWarning(t.target.files.length),void(this.uploading=!1);const n=t=>(e,a)=>{this.uploads[t].uploaded=a,this.attachments.map(((e,n)=>(e.displayName===t&&(this.attachments[n].progress=a,this.changeProgress(e,a)),e)))},i=y()((t=>{const e=new AbortController;this.attachments.push({fileName:t.name,fileType:t.type,imageBlobURL:this.generatePreview(t),displayName:h()("/",t.name),progress:null,percent:0,total:t.size,finished:!1,error:!1,hasPreview:!1,controller:e}),B.ZP.set(this.uploads,t.name,{total:t.size,uploaded:0});try{return(0,L.L5)(t,n(t.name),e).catch((()=>{this.attachments.some((e=>e.displayName===t.name&&!e.error&&(this.$set(e,"error",!0),!0)))})).then((t=>{let{file:e,id:a}=t;r.Z.info("local attachment uploaded",{file:e,id:a}),this.emitNewAttachments([{fileName:e.name,displayName:h()("/",e.name),id:a,size:e.size,type:"local"}])}))}catch(e){r.Z.error("Could not upload file",{file:t,error:e})}}),t.target.files),o=Promise.all(i).catch((t=>r.Z.error("could not upload all attachments",{error:t}))).then((()=>this.uploading=!1));return this.$emit("upload",o),o},async onAddCloudAttachment(){const t=(0,o.fn)((0,s.Iu)("mail","Choose a file to add as attachment")).setMultiSelect(!0).build();try{const e=await t.pick((0,s.Iu)("mail","Choose a file to add as attachment")),a=await Promise.all(e.map(I)),n=a.reduce(((t,e)=>t+e.size),0)+this.totalSizeOfUpload();if(this.uploadSizeLimit&&n>this.uploadSizeLimit)return void this.showAttachmentFileSizeWarning(e.length);this.emitNewAttachments(e.map(((t,e)=>{const n={fileName:t,displayName:h()("/",t),type:"cloud",size:a[e].size},i={finished:!0,imageBlobURL:this.generatePreview(n),total:a[e].size,sizeString:this.formatBytes(a[e].size),hasPreview:a[e]["has-preview"],id:a[e].fileid,uploaded:0};return this.attachments.push(Object.assign(i,n)),n})))}catch(t){r.Z.error("could not choose a file as attachment",{error:t})}},async onAddCloudAttachmentLink(){const e=(0,o.fn)((0,s.Iu)("mail","Choose a file to share as a link")).build();try{const a=await e.pick((0,s.Iu)("mail","Choose a file to share as a link")),n=await async function(e,a){try{return(await T.Z.post((0,E.generateOcsUrl)("apps/files_sharing/api/v1/",2)+"shares",{shareType:3,path:e,shareWith:a})).data.ocs.data.url}catch(e){throw e.response&&e.response.data&&e.response.data.ocs&&e.response.data.ocs.meta&&e.response.data.ocs.meta.message?(console.error("Error while sharing file: ".concat(e.response.data.ocs.meta.message||"Unknown error")),(0,o.x2)(e.response.data.ocs.meta.message),e):(console.error("Error while sharing file: Unknown error"),(0,o.x2)(t("mail","Error while sharing file")),e)}}(a,(0,w.IH)());this.appendToBodyAtCursor('<a href="'.concat(n,'">').concat(n,"</a>"))}catch(t){r.Z.error("could not choose a file as attachment link",{error:t})}},onAddMessageAsAttachment(t){let{id:e,fileName:a}=t;const n={type:"message",id:e,fileName:a};this.attachments.push({...n,finished:!0}),this.emitNewAttachments([n])},showAttachmentFileSizeWarning(t){(0,o.K2)((0,s.uN)("mail","The attachment exceed the allowed attachments size of {size}. Please share the file via link instead.","The attachments exceed the allowed attachments size of {size}. Please share the files via link instead.",t,{size:(0,x.s)(this.uploadSizeLimit)}))},onDelete(t){t.finished||t.controller.abort();const e=t.fileName,a=(t.displayName,t.id),n=(t.total,t.type),i=this.attachments.filter((e=>e!==t));this.attachments=i,this.$emit("input",this.value.filter((t=>"cloud"===n?t.fileName!==e:t.id!==a)))},appendToBodyAtCursor(t){this.bus.$emit("append-to-body-at-cursor",t)},formatBytes(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(0===t)return"0 B";const a=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(a))+" "+["B","KB","MB","GB","TB","PB","EB","ZB","YB"][n]},changeProgress(t,e){this.attachments.map(((a,n)=>{if(t.fileName===a.fileName&&!a.finished){const n=e<=a.total?e:a.total;this.$set(a,"progress",n),this.$set(a,"sizeString",this.formatBytes(n)),this.$set(a,"percent",n/a.total*100).toFixed(1),t.total<=n&&this.$set(a,"finished",!0)}return a}))},generatePreview(t){return!!this.isImage(t)&&URL.createObjectURL(t)},isImage:t=>t.type&&-1!==at.indexOf(t.type)}};var it=n(2002),ot={};ot.styleTagTransform=H(),ot.setAttributes=j(),ot.insert=G().bind(null,"head"),ot.domAPI=O(),ot.insertStyleElement=W(),N()(it.Z,ot),it.Z&&it.Z.locals&&it.Z.locals;const st=(0,X.Z)(nt,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"new-message-attachments"},[t.hasNextLine?e("div",{staticClass:"new-message-attachments--counter",class:{"new-message-attachments--counter--with-errors":t.hasAttachmentErrors},on:{click:function(e){t.isToggle=!t.isToggle}}},[e("span",[t._v("\n\t\t\t"+t._s(t.n("mail","{count} attachment","{count} attachments",t.attachments.length,{count:t.attachments.length}))+" ("+t._s(t.formatBytes(t.totalSizeOfUpload()))+")\n\t\t")]),t._v(" "),t.isToggle?e("ChevronUp",{attrs:{size:24}}):t._e(),t._v(" "),t.isToggle?t._e():e("ChevronDown",{attrs:{size:24}})],1):t._e(),t._v(" "),e("ul",{staticClass:"new-message-attachments--list",class:{hide:t.isToggle,active:!t.isToggle&&t.hasNextLine}},t._l(t.attachments,(function(a){return e("ComposerAttachment",{key:a.id,ref:"attachments",refInFor:!0,attrs:{bus:t.bus,attachment:a,uploading:t.uploading},on:{"on-delete-attachment":function(e){return t.onDelete(a)}}})})),1),t._v(" "),e("input",{ref:"localAttachments",staticStyle:{display:"none"},attrs:{type:"file",multiple:""},on:{change:t.onLocalAttachmentSelected}})])}),[],!1,null,"201da0a4",null).exports;var rt=n(34020),ct=n(86119),lt=n(81170),dt=n(90207),mt=n(93759);const At={name:"RecipientListItem",components:{ListItemIcon:i.Ic,Close:R.default},props:{option:{type:Object,required:!0}},methods:{removeRecipient(t,e){this.$emit("remove-recipient",t,e)}}};var pt=n(7479),ht={};ht.styleTagTransform=H(),ht.setAttributes=j(),ht.insert=G().bind(null,"head"),ht.domAPI=O(),ht.insertStyleElement=W(),N()(pt.Z,ht),pt.Z&&pt.Z.locals&&pt.Z.locals;const ut=(0,X.Z)(At,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"multiselect__tag multiselect__tag--recipient",attrs:{title:t.option.email}},[e("ListItemIcon",{attrs:{"no-margin":!0,title:t.option.label,url:t.option.photo,"avatar-size":24}}),t._v(" "),e("Close",{staticClass:"delete-recipient",attrs:{size:20},on:{click:function(e){return e.preventDefault(),t.removeRecipient(t.option)}}})],1)}),[],!1,null,"3b5528ea",null).exports;var gt=n(76985),Ct=n(49787),ft=n(96885),vt=n(83138),bt=n(55594),yt=n(31588),wt=n(52796);const xt={name:"MailvelopeEditor",props:{value:{type:String,required:!0},recipients:{type:Array,required:!0},quotedText:{type:Object,required:!1,default:()=>{}},isReplyOrForward:{type:Boolean,default:!1}},data:()=>({editor:void 0}),async mounted(){var t;const e=!!this.quotedText&&(0,wt.b)(this.quotedText),a=this.isReplyOrForward?null===(t=this.quotedText)||void 0===t?void 0:t.value:void 0;this.editor=await window.mailvelope.createEditorContainer("#mailvelope-composer",void 0,{quotedMail:e?a:void 0})},methods:{async pull(){const t=this.recipients.map((t=>t.email));r.Z.info("encrypting message",{recipients:t});const e=await this.editor.encrypt(t);r.Z.info("message encryted",{armored:e}),this.$emit("input",e)}}};var _t=n(6885),Dt={};Dt.styleTagTransform=H(),Dt.setAttributes=j(),Dt.insert=G().bind(null,"head"),Dt.domAPI=O(),Dt.insertStyleElement=W(),N()(_t.Z,Dt),_t.Z&&_t.Z.locals&&_t.Z.locals;const kt=(0,X.Z)(xt,(function(){return(0,this._self._c)("div",{attrs:{id:"mailvelope-composer"}})}),[],!1,null,"695d8526",null).exports;var St=n(90066),Bt=n(86680),Mt=n(56855),It=n(61632),Tt=n(80351),Et=n.n(Tt),Lt=n(20629),Rt=n(11130),zt=n(98238);const Pt=C()(vt.l,500);B.ZP.use(u);const Ft={name:"Composer",components:{MailvelopeEditor:kt,Actions:i.O3,ActionButton:i.Js,ActionCheckbox:i.Bt,ActionInput:i.Iw,ActionRadio:i.Iz,ButtonVue:i.P2,ComposerAttachments:st,ChevronLeft:f.default,Delete:v.Z,Download:rt.Z,IconUpload:ct.Z,IconFolder:lt.default,IconPublic:dt.Z,IconLinkPicker:mt.Z,Multiselect:i.Z2,Select:i.QG,TextEditor:bt.Z,ListItemIcon:i.Ic,RecipientListItem:ut,Send:Mt.Z,SendClock:It.Z,UnfoldMoreHorizontal:gt.Z,UnfoldLessHorizontal:Ct.Z,IconHtml:ft.Z,IconClose:R.default,NcReferencePickerModal:Bt.NcReferencePickerModal},props:{fromAccount:{type:Number,default:()=>{}},fromAlias:{type:Number,default:void 0},to:{type:Array,default:()=>[]},cc:{type:Array,default:()=>[]},bcc:{type:Array,default:()=>[]},subject:{type:String,default:""},body:{type:Object,default:()=>(0,c.dy)("")},editorBody:{type:String,default:""},inReplyToMessageId:{type:String,default:void 0},replyTo:{type:Object,required:!1,default:()=>{}},forwardFrom:{type:Object,required:!1,default:()=>{}},forwardedMessages:{type:Array,required:!1,default:()=>[]},sendAt:{type:Number,default:void 0},attachmentsData:{type:Array,default:()=>[]},error:{type:String,default:void 0},canSaveDraft:{type:Boolean,default:!1},uploadingAttachments:{type:Boolean,default:!1},savingDraft:{type:Boolean,default:!1},draftSaved:{type:Boolean,default:!1},smimeSign:{type:Boolean,default:!1},smimeEncrypt:{type:Boolean,default:!1},isFirstOpen:{type:Boolean,required:!0},requestMdn:{type:Boolean,default:!1},accounts:{type:Array,required:!0}},data(){var t,e,a;const n=new Date;return n.setHours(n.getHours()+1),{showCC:this.cc.length>0,showBCC:this.bcc.length>0,selectedAlias:-1,autocompleteRecipients:this.to.concat(this.cc).concat(this.bcc),newRecipients:[],subjectVal:this.subject,bodyVal:this.editorBody,attachments:this.attachmentsData,noReply:this.to.some((t=>{var e,a;return(null===(e=t.email)||void 0===e?void 0:e.startsWith("noreply@"))||(null===(a=t.email)||void 0===a?void 0:a.startsWith("no-reply@"))})),saveDraftDebounced:d()(5e3,this.saveDraft),selectTo:this.to,selectCc:this.cc,selectBcc:this.bcc,bus:new B.ZP,encrypt:!1,mailvelope:{available:!1,keyRing:void 0,keysMissing:[]},editorMode:"html"!==(null===(t=this.body)||void 0===t?void 0:t.format)?zt.GZ:zt.bu,addShareLink:(0,s.Iu)("mail","Add share link from {productName} Files",{productName:null!==(e=null===(a=OC)||void 0===a||null===(a=a.theme)||void 0===a?void 0:a.name)&&void 0!==e?e:"Nextcloud"}),requestMdnVal:this.requestMdn,changeSignature:!1,loadingIndicatorTo:!1,loadingIndicatorCc:!1,loadingIndicatorBcc:!1,isActionsOpen:!1,isMoreActionsOpen:!1,selectedDate:n,sendAtVal:this.sendAt,firstDayDatetimePicker:0===(0,s.yo)()?7:(0,s.yo)(),formatter:{stringify:t=>t?Et()(t).format("LLL"):"",parse:t=>t?Et()(t,"LLL").toDate():null},autoLimit:!0,wantsSmimeSign:this.smimeSign,wantsSmimeEncrypt:this.smimeEncrypt,isPickerOpen:!1}},computed:{...(0,Lt.Se)(["isScheduledSendingDisabled"]),isPickerAvailable(){return parseInt(this.$store.getters.getNcVersion)>=26},aliases(){let t=0;return this.accounts.filter((t=>!t.isUnified)).flatMap((e=>[{id:e.id,aliasId:null,selectId:t++,editorMode:e.editorMode,signature:e.signature,name:e.name,emailAddress:e.emailAddress,signatureAboveQuote:e.signatureAboveQuote,smimeCertificateId:e.smimeCertificateId,selectable:e.connectionStatus},e.aliases.map((a=>({id:e.id,aliasId:a.id,selectId:t++,editorMode:e.editorMode,signature:a.signature,name:a.name,emailAddress:a.alias,signatureAboveQuote:e.signatureAboveQuote,smimeCertificateId:a.smimeCertificateId,selectable:e.connectionStatus})))])).flat()},allRecipients(){return this.selectTo.concat(this.selectCc).concat(this.selectBcc)},dateToday:()=>new Date((new Date).setDate((new Date).getDate())),attachmentSizeLimit(){return this.$store.getters.getPreference("attachment-size-limit")},selectableRecipients(){return this.newRecipients.concat(this.autocompleteRecipients).map((t=>({...t,label:t.label||t.email})))},isForward(){return void 0!==this.forwardFrom},isReply(){return void 0!==this.replyTo},canSend(){return!(this.wantsSmimeEncrypt&&(!this.smimeCertificateForCurrentAlias||this.missingSmimeCertificatesForRecipients.length)||this.encrypt&&this.mailvelope.keysMissing.length||!(this.selectTo.length>0||this.selectCc.length>0||this.selectBcc.length>0))},editorPlainText(){return this.editorMode===zt.GZ},submitButtonTitle(){return this.wantsSmimeEncrypt?this.sendAtVal?(0,s.Iu)("mail","Encrypt with S/MIME and send later")+" ".concat(this.convertToLocalDate(this.sendAtVal)):(0,s.Iu)("mail","Encrypt with S/MIME and send"):this.mailvelope.available&&this.encrypt?this.sendAtVal?(0,s.Iu)("mail","Encrypt with Mailvelope and send later")+" ".concat(this.convertToLocalDate(this.sendAtVal)):(0,s.Iu)("mail","Encrypt with Mailvelope and send"):this.sendAtVal?(0,s.Iu)("mail","Send later")+" ".concat(this.convertToLocalDate(this.sendAtVal)):(0,s.Iu)("mail","Send")},dateTomorrowMorning(){const t=new Date;return t.setTime(t.getTime()+864e5),t.setHours(9,0,0,0)},dateTomorrowAfternoon(){const t=new Date;return t.setTime(t.getTime()+864e5),t.setHours(14,0,0,0)},dateMondayMorning(){const t=new Date;return t.setHours(9,0,0,0),t.setDate(t.getDate()+(7-t.getDay())%7+1)},customSendTime(){return new Date(this.selectedDate).getTime()},showAmPm:()=>-1!==Et()().locale((0,s.Kd)()).localeData().longDateFormat("LT").toLowerCase().indexOf("a"),isSendAtTomorrowMorning(){return!(!this.sendAtVal||Math.floor(this.dateTomorrowMorning/1e3)!==Math.floor(this.sendAtVal/1e3))},isSendAtTomorrowAfternoon(){return!(!this.sendAtVal||Math.floor(this.dateTomorrowAfternoon/1e3)!==Math.floor(this.sendAtVal/1e3))},isSendAtMondayMorning(){return!(!this.sendAtVal||Math.floor(this.dateMondayMorning/1e3)!==Math.floor(this.sendAtVal/1e3))},isSendAtCustom(){return!(!this.sendAtVal||this.isSendAtTomorrowMorning||this.isSendAtTomorrowAfternoon||this.isSendAtMondayMorning)},smimeCertificateForCurrentAlias(){if(-1!==this.selectedAlias)return this.smimeCertificateForAlias(this.selectedAlias)},shouldSmimeSign(){return this.wantsSmimeSign&&!!this.smimeCertificateForCurrentAlias},shouldSmimeEncrypt(){return this.wantsSmimeEncrypt&&!!this.smimeCertificateForCurrentAlias&&0===this.missingSmimeCertificatesForRecipients.length},missingSmimeCertificatesForRecipients(){const t=[];return this.allRecipients.forEach((e=>{this.$store.getters.getSmimeCertificateByEmail(e.email)||t.push(e.email)})),t}},watch:{"$route.params.threadId"(){this.reset()},allRecipients(){this.checkRecipientsKeys()},aliases(t){if(console.debug("aliases changed"),-1===this.selectedAlias)return;const e=t.find((t=>t.id===this.selectedAlias.id&&t.aliasId===this.selectedAlias.aliasId));void 0===e?this.onAliasChange(t[0]):this.onAliasChange(e)},selectTo(t){this.$emit("update:to",t)},selectCc(t){this.$emit("update:cc",t)},selectBcc(t){this.$emit("update:bcc",t)},subjectVal(t){this.$emit("update:subject",t)},bodyVal(t){this.$emit("update:editor-body",t)},attachments(t){this.$emit("update:attachments-data",t)},sendAtVal(t){this.$emit("update:send-at",t)},wantsSmimeSign(t){this.$emit("update:smime-sign",t)},wantsSmimeEncrypt(t){this.$emit("update:smime-encrypt",t)},requestMdnVal(t){this.$emit("update:request-mdn",t)}},async beforeMount(){this.setAlias(),this.initBody(),await this.onMailvelopeLoaded(await(0,St.T)())},mounted(){var t;!this.isReply&&this.isFirstOpen&&this.$nextTick((()=>this.$refs.toLabel.$el.focus())),void 0!==(null===(t=this.forwardFrom)||void 0===t?void 0:t.attachments)&&this.forwardFrom.attachments.forEach((t=>{this.attachments.push({fileName:t.fileName,displayName:h()("/",t.fileName),id:t.id,messageId:this.forwardFrom.databaseId,type:"message-attachment"})}));for(const t of this.forwardedMessages){const e=this.$store.getters.getEnvelope(t);e?this.bus.$emit("on-add-message-as-attachment",{id:t,fileName:e.subject+".eml"}):(0,o.x2)((0,s.Iu)("mail","Message {id} could not be found",{id:t}))}this.sendAt&&this.isSendAtCustom&&(this.selectedDate=new Date(this.sendAt))},beforeDestroy(){window.removeEventListener("mailvelope",this.onMailvelopeLoaded)},methods:{handleShow(t){this.$emit("show-toolbar",t)},openPicker(){this.isPickerOpen=!0},closePicker(){this.isPickerOpen=!1},setAlias(){const t=this.selectedAlias;if(this.fromAccount&&this.fromAlias)this.selectedAlias=this.aliases.find((t=>t.id===this.fromAccount&&t.aliasId===this.fromAlias));else if(this.fromAccount)this.selectedAlias=this.aliases.find((t=>t.id===this.fromAccount&&!t.aliasId));else{var e;const t=null===(e=this.$store.getters.getMailbox(this.$route.params.mailboxId))||void 0===e?void 0:e.accountId;this.selectedAlias=t?this.aliases.find((e=>e.id===t)):this.aliases[0]}-1!==t||this.body&&""!==this.body.value||(this.editorMode=this.selectedAlias.editorMode)},async checkRecipientsKeys(){if(!this.encrypt||!this.mailvelope.available)return;const t=this.allRecipients.map((t=>t.email)),e=await this.mailvelope.keyRing.validKeyForAddress(t);r.Z.debug("recipients keys validated",{recipients:t,keysValid:e}),this.mailvelope.keysMissing=t.filter((t=>!1===e[t]))},initBody(){let t;t=this.replyTo&&this.isFirstOpen?(0,yt.Gx)(this.editorPlainText?(0,c.UK)(this.body):(0,c.vb)(this.body),this.replyTo.from[0],this.replyTo.dateInt,"top"===this.$store.getters.getPreference("reply-mode","top")).value:this.forwardFrom&&this.isFirstOpen?(0,yt.Gx)(this.editorPlainText?(0,c.UK)(this.body):(0,c.vb)(this.body),this.forwardFrom.from[0],this.forwardFrom.dateInt,"top"===this.$store.getters.getPreference("reply-mode","top")).value:this.bodyVal,this.bodyVal=(0,c.dy)(t).value},getMessageData(){var t,e;return{account:this.selectedAlias.id,accountId:this.selectedAlias.id,aliasId:this.selectedAlias.aliasId,to:this.selectTo,cc:this.selectCc,bcc:this.selectBcc,subject:this.subjectVal,body:this.encrypt?(0,c.Oh)(this.bodyVal):(0,c.dy)(this.bodyVal),attachments:this.attachments,inReplyToMessageId:null!==(t=this.inReplyToMessageId)&&void 0!==t?t:this.replyTo?this.replyTo.messageId:void 0,isHtml:!this.encrypt&&!this.editorPlainText,requestMdn:this.requestMdnVal,sendAt:this.sendAtVal?Math.floor(this.sendAtVal/1e3):void 0,smimeSign:this.shouldSmimeSign,smimeEncrypt:this.shouldSmimeEncrypt,smimeCertificateId:null===(e=this.smimeCertificateForCurrentAlias)||void 0===e?void 0:e.id}},saveDraft(){var t;const e=this.getMessageData();""!==e.subject||""!==(null===(t=e.body)||void 0===t?void 0:t.value)||0!==e.cc.length||0!==e.bcc.length||0!==e.to.length||void 0!==e.sendAt?this.$emit("draft",e):r.Z.debug("Nothing substantial to save, ignoring draft save")},insertSignature(){let t;t=this.changeSignature?Rt.tj:Rt.LQ,this.$refs.editor.editorExecute("insertSignature",t,(0,c.vb)((0,c.qY)(this.selectedAlias.signature)).value,this.selectedAlias.signatureAboveQuote),this.changeSignature=!1},onPicked(t){this.closePicker(),this.bus.$emit("append-to-body-at-cursor",t)},onEditorInput(t){this.bodyVal=t,this.saveDraftDebounced()},onEditorReady(t){this.bodyVal=t.getData(),this.insertSignature()},onChangeSendLater(t){this.sendAtVal=t?Number.parseInt(t,10):void 0},convertToLocalDate:t=>new Date(t).toLocaleString((0,s.aj)(),{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),onAliasChange(t){r.Z.debug("changed alias",{alias:t}),this.selectedAlias=t,this.changeSignature=!0,this.$emit("update:from-account",t.id),t.aliasId&&this.$emit("update:from-alias",t.aliasId),(this.wantsSmimeSign||this.wantsSmimeEncrypt)&&(this.smimeCertificateForAlias(t)||(this.wantsSmimeSign=!1,this.wantsSmimeEncrypt=!1,(0,o.K2)((0,s.Iu)("mail","Sign or Encrypt with S/MIME was selected, but we don't have a certificate for the selected alias. The message will not be signed or encrypted.")))),this.editorMode===zt.GZ&&t.editorMode===zt.bu?this.editorMode=zt.bu:this.insertSignature()},onAddLocalAttachment(){this.bus.$emit("on-add-local-attachment"),this.saveDraftDebounced()},onAddCloudAttachment(){this.bus.$emit("on-add-cloud-attachment"),this.saveDraftDebounced()},onAddCloudAttachmentLink(){this.bus.$emit("on-add-cloud-attachment-link")},onAutocomplete(t,e){void 0!==t&&""!==t&&(this.loadingIndicatorTo="to"===e,this.loadingIndicatorCc="cc"===e,this.loadingIndicatorBcc="bcc"===e,Pt(t).then((t=>{"to"===e?this.loadingIndicatorTo=!1:"cc"===e?this.loadingIndicatorCc=!1:"bcc"===e&&(this.loadingIndicatorBcc=!1);for(const e of t)e.label||(e.label=e.email);this.autocompleteRecipients=A()("email")(this.autocompleteRecipients.concat(t))})))},async onMailvelopeLoaded(t){this.encrypt=(0,wt.b)(this.body),this.mailvelope.available=!0,r.Z.info("Mailvelope loaded",{encrypt:this.encrypt,isPgpgMessage:(0,wt.b)(this.body),keyRing:this.mailvelope.keyRing}),this.mailvelope.keyRing=await t.getKeyring(),await this.checkRecipientsKeys()},onNewToAddr(t){this.onNewAddr(t,this.selectTo)},onNewCcAddr(t){this.onNewAddr(t,this.selectCc)},onNewBccAddr(t){this.onNewAddr(t,this.selectBcc)},onNewAddr(t,e){let a=t;"string"==typeof t&&(a={label:t,email:t}),this.newRecipients.push(a),e.push(a),this.saveDraftDebounced()},async onSend(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.encrypt&&(r.Z.debug("get encrypted message from mailvelope"),await this.$refs.mailvelopeEditor.pull()),this.$emit("send",{...this.getMessageData(),force:e})},reset(){this.selectTo=[],this.selectCc=[],this.selectBcc=[],this.subjectVal="",this.bodyVal="<p></p><p></p>",this.attachments=[],this.autocompleteRecipients=[],this.newRecipients=[],this.requestMdnVal=!1,this.changeSignature=!1,this.sendAtVal=void 0,this.setAlias(),this.initBody()},formatAliases:t=>t.name?"".concat(t.name," <").concat(t.emailAddress,">"):t.emailAddress,disabledDatetimepickerDate(t){const e=new Date;return e.setHours(0,0,0),e.setSeconds(e.getSeconds()-1),t.getTime()<=e},disabledDatetimepickerTime(t){const e=new Date,a=new Date(e.getTime());return t.getTime()<=a},onRemoveRecipient(t,e){switch(e){case"to":this.removeRecipientTo(t);break;case"cc":this.removeRecipientCc(t);break;case"bcc":this.removeRecipientBcc(t)}},removeRecipient:(t,e)=>e.filter((e=>e.email!==t.email)),removeRecipientTo(t){this.selectTo=this.removeRecipient(t,this.selectTo)},removeRecipientCc(t){this.selectCc=this.removeRecipient(t,this.selectCc)},removeRecipientBcc(t){this.selectBcc=this.removeRecipient(t,this.selectBcc)},toggleViewMode(){this.autoLimit=!this.autoLimit,this.showCC=!(this.showCC&&0===this.selectCc.length&&this.autoLimit),this.showBCC=!(this.showBCC&&0===this.selectBcc.length&&this.autoLimit)},setEditorModeHtml(){this.editorMode=zt.bu},setEditorModeText(){OC.dialogs.confirmDestructive((0,s.Iu)("mail","Any existing formatting (for example bold, italic, underline or inline images) will be removed."),(0,s.Iu)("mail","Turn off formatting"),{type:OC.dialogs.YES_NO_BUTTONS,confirm:(0,s.Iu)("mail","Turn off and remove formatting"),confirmClasses:"error",cancel:(0,s.Iu)("mail","Keep formatting")},(t=>{t&&(this.editorMode=zt.GZ)}))},smimeCertificateForAlias(t){const e=t.smimeCertificateId;if(e)return this.$store.getters.getSmimeCertificate(e)}}},$t=Ft;var Nt=n(53638),Zt={};Zt.styleTagTransform=H(),Zt.setAttributes=j(),Zt.insert=G().bind(null,"head"),Zt.domAPI=O(),Zt.insertStyleElement=W(),N()(Nt.Z,Zt),Nt.Z&&Nt.Z.locals&&Nt.Z.locals;const Ot=(0,X.Z)($t,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"message-composer"},[t.isPickerAvailable&&t.isPickerOpen?e("NcReferencePickerModal",{on:{submit:t.onPicked,cancel:t.closePicker}}):t._e(),t._v(" "),e("div",{staticClass:"composer-fields composer-fields__from mail-account"},[e("label",{staticClass:"from-label",attrs:{for:"from"}},[t._v("\n\t\t\t"+t._s(t.t("mail","From"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"composer-fields--custom"},[e("Select",{attrs:{id:"from",value:t.selectedAlias,options:t.aliases,label:"name","track-by":"selectId",searchable:!1,placeholder:t.t("mail","Select account"),"clear-on-select":!1,"append-to-body":!1,selectable:t=>t.selectable},on:{"option:selected":t.onAliasChange},scopedSlots:t._u([{key:"option",fn:function(e){return[t._v("\n\t\t\t\t\t"+t._s(t.formatAliases(e))+"\n\t\t\t\t")]}},{key:"selected-option",fn:function(e){return[t._v("\n\t\t\t\t\t"+t._s(t.formatAliases(e))+"\n\t\t\t\t")]}}])})],1)]),t._v(" "),e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"to-label",attrs:{for:"to"}},[t._v("\n\t\t\t"+t._s(t.t("mail","To"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"composer-fields--custom"},[e("Multiselect",{ref:"toLabel",class:{opened:!t.autoLimit},attrs:{id:"to",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0,placeholder:t.t("mail","Contact or email address "),"clear-on-select":!0,"close-on-select":!1,"show-no-options":!1,"preserve-search":!0,"hide-selected":!0,loading:t.loadingIndicatorTo,"auto-limit":t.autoLimit,"options-limit":30},on:{input:t.saveDraftDebounced,tag:t.onNewToAddr,"search-change":function(e){return t.onAutocomplete(e,"to")}},scopedSlots:t._u([{key:"tag",fn:function(a){let{option:n}=a;return[e("RecipientListItem",{attrs:{option:n},on:{"remove-recipient":function(e){return t.onRemoveRecipient(n,"to")}}})]}},{key:"option",fn:function(t){let{option:a}=t;return[e("div",{staticClass:"multiselect__tag multiselect__tag-custom"},[e("ListItemIcon",{attrs:{"no-margin":!0,title:a.label,subtitle:a.email,url:a.photo,"avatar-size":24}})],1)]}}]),model:{value:t.selectTo,callback:function(e){t.selectTo=e},expression:"selectTo"}}),t._v(" "),e("button",{class:{active:!t.autoLimit},attrs:{title:t.t("mail","Toggle recipients list mode")},on:{click:function(e){return e.preventDefault(),t.toggleViewMode.apply(null,arguments)}}},[t.autoLimit?e("UnfoldMoreHorizontal",{attrs:{size:24}}):e("UnfoldLessHorizontal",{attrs:{size:24}})],1)],1)]),t._v(" "),t.showCC?e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"cc-label",attrs:{for:"cc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Cc"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"composer-fields--custom"},[e("Multiselect",{class:{opened:!t.autoLimit},attrs:{id:"cc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0,placeholder:t.t("mail","Contact or email address "),"clear-on-select":!0,"show-no-options":!1,"preserve-search":!0,loading:t.loadingIndicatorCc,"auto-limit":t.autoLimit,"hide-selected":!0,"options-limit":30},on:{input:t.saveDraftDebounced,tag:t.onNewCcAddr,"search-change":function(e){return t.onAutocomplete(e,"cc")}},scopedSlots:t._u([{key:"tag",fn:function(a){let{option:n}=a;return[e("RecipientListItem",{attrs:{option:n},on:{"remove-recipient":function(e){return t.onRemoveRecipient(n,"cc")}}})]}},{key:"option",fn:function(t){let{option:a}=t;return[e("div",{staticClass:"multiselect__tag multiselect__tag-custom"},[e("ListItemIcon",{attrs:{"no-margin":!0,title:a.label,subtitle:a.email,url:a.photo,"avatar-size":24}})],1)]}}],null,!1,1021015760),model:{value:t.selectCc,callback:function(e){t.selectCc=e},expression:"selectCc"}},[t._v(" "),t._v(" "),e("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v(t._s(t.t("mail","")))])])],1)]):t._e(),t._v(" "),t.showBCC?e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"bcc-label",attrs:{for:"bcc"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Bcc"))+"\n\t\t")]),t._v(" "),e("div",{staticClass:"composer-fields--custom"},[e("Multiselect",{class:{opened:!t.autoLimit},attrs:{id:"bcc",options:t.selectableRecipients,taggable:!0,label:"label","track-by":"email",multiple:!0,placeholder:t.t("mail","Contact or email address "),"show-no-options":!1,"clear-on-select":!0,"preserve-search":!0,loading:t.loadingIndicatorBcc,"hide-selected":!0,"options-limit":30},on:{input:t.saveDraftDebounced,tag:t.onNewBccAddr,"search-change":function(e){return t.onAutocomplete(e,"bcc")}},scopedSlots:t._u([{key:"tag",fn:function(a){let{option:n}=a;return[e("RecipientListItem",{attrs:{option:n},on:{"remove-recipient":function(e){return t.onRemoveRecipient(n,"bcc")}}})]}},{key:"option",fn:function(t){let{option:a}=t;return[e("div",{staticClass:"multiselect__tag multiselect__tag-custom"},[e("ListItemIcon",{attrs:{"no-margin":!0,title:a.label,subtitle:a.email,url:a.photo,"avatar-size":24}})],1)]}}],null,!1,2370059090),model:{value:t.selectBcc,callback:function(e){t.selectBcc=e},expression:"selectBcc"}},[t._v(" "),t._v(" "),e("span",{attrs:{slot:"noOptions"},slot:"noOptions"},[t._v(t._s(t.t("mail","No contacts found.")))])])],1)]):t._e(),t._v(" "),e("div",{staticClass:"composer-fields"},[e("label",{staticClass:"subject-label hidden-visually",attrs:{for:"subject"}},[t._v("\n\t\t\t"+t._s(t.t("mail","Subject"))+"\n\t\t")]),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.subjectVal,expression:"subjectVal"}],staticClass:"subject",attrs:{id:"subject",type:"text",name:"subject",autocomplete:"off",placeholder:t.t("mail","Subject ")},domProps:{value:t.subjectVal},on:{input:[function(e){e.target.composing||(t.subjectVal=e.target.value)},t.saveDraftDebounced]}})]),t._v(" "),t.noReply?e("div",{staticClass:"warning noreply-warning"},[t._v("\n\t\t"+t._s(t.t("mail","This message came from a noreply address so your reply will probably not be read."))+"\n\t")]):t._e(),t._v(" "),t.wantsSmimeEncrypt&&t.missingSmimeCertificatesForRecipients.length?e("div",{staticClass:"warning noreply-warning"},[t._v("\n\t\t"+t._s(t.t("mail","The following recipients do not have a S/MIME certificate: {recipients}.",{recipients:t.missingSmimeCertificatesForRecipients.join(", ")}))+"\n\t")]):t._e(),t._v(" "),t.encrypt&&t.mailvelope.keysMissing.length?e("div",{staticClass:"warning noreply-warning"},[t._v("\n\t\t"+t._s(t.t("mail","The following recipients do not have a PGP key: {recipients}.",{recipients:t.mailvelope.keysMissing.join(", ")}))+"\n\t")]):t._e(),t._v(" "),e("div",{staticClass:"composer-fields message-editor"},[t.encrypt?e("MailvelopeEditor",{ref:"mailvelopeEditor",attrs:{value:t.bodyVal,recipients:t.allRecipients,"quoted-text":t.body,"is-reply-or-forward":t.isReply||t.isForward},on:{input:t.onEditorInput}}):e("TextEditor",{key:t.editorMode,ref:"editor",staticClass:"message-body",attrs:{value:t.bodyVal,html:!t.editorPlainText,name:"body",placeholder:t.t("mail","Write message "),focus:t.isReply||!t.isFirstOpen,bus:t.bus},on:{input:t.onEditorInput,ready:t.onEditorReady,"show-toolbar":t.handleShow}})],1),t._v(" "),e("ComposerAttachments",{attrs:{bus:t.bus,"upload-size-limit":t.attachmentSizeLimit},on:{upload:function(e){t.$emit("upload-attachment",e,t.getMessageData())}},model:{value:t.attachments,callback:function(e){t.attachments=e},expression:"attachments"}}),t._v(" "),e("div",{staticClass:"composer-actions-right composer-actions"},[e("div",{staticClass:"composer-actions--primary-actions"},[e("p",{staticClass:"composer-actions-draft-status"},[t.savingDraft?e("span",{staticClass:"draft-status"},[t._v(t._s(t.t("mail","Saving draft ")))]):t.canSaveDraft?t.draftSaved?e("span",{staticClass:"draft-status"},[t._v(t._s(t.t("mail","Draft saved")))]):t._e():e("span",{staticClass:"draft-status"},[t._v(t._s(t.t("mail","Error saving draft")))])]),t._v(" "),t.savingDraft||t.canSaveDraft?t._e():e("ButtonVue",{staticClass:"button",attrs:{type:"tertiary","aria-label":t.t("mail","Save draft")},on:{click:t.saveDraft},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Download",{attrs:{size:20,title:t.t("mail","Save draft")}})]},proxy:!0}],null,!1,2227301918)}),t._v(" "),!t.savingDraft&&t.draftSaved?e("ButtonVue",{staticClass:"button",attrs:{type:"tertiary","aria-label":t.t("mail","Discard & close draft")},on:{click:function(e){return t.$emit("discard-draft")}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Delete",{attrs:{size:20,title:t.t("mail","Discard & close draft")}})]},proxy:!0}],null,!1,3896853704)}):t._e()],1),t._v(" "),e("div",{staticClass:"composer-actions--secondary-actions"},[e("Actions",{attrs:{open:t.isActionsOpen},on:{"update:open":function(e){t.isActionsOpen=e},close:function(e){t.isMoreActionsOpen=!1}}},[t.isMoreActionsOpen?t._e():[e("ActionButton",{on:{click:t.onAddLocalAttachment},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconUpload",{attrs:{size:20}})]},proxy:!0}],null,!1,337456192)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Upload attachment"))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionButton",{on:{click:t.onAddCloudAttachment},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconFolder",{attrs:{size:20}})]},proxy:!0}],null,!1,2686820117)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Add attachment from Files"))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionButton",{attrs:{disabled:t.encrypt},on:{click:t.onAddCloudAttachmentLink},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconPublic",{attrs:{size:20}})]},proxy:!0}],null,!1,1361450402)},[t._v("\n\t\t\t\t\t\t"+t._s(t.addShareLink)+"\n\t\t\t\t\t")]),t._v(" "),t.isPickerAvailable?e("ActionButton",{attrs:{"close-after-click":!0},on:{click:t.openPicker},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconLinkPicker",{attrs:{size:20}})]},proxy:!0}],null,!1,3539100229)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Smart picker"))+"\n\t\t\t\t\t")]):t._e(),t._v(" "),t.isScheduledSendingDisabled?t._e():e("ActionButton",{attrs:{"close-after-click":!1},on:{click:function(e){t.isMoreActionsOpen=!0}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("SendClock",{attrs:{size:20,title:t.t("mail","Send later")}})]},proxy:!0}],null,!1,1769650344)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Send later"))+"\n\t\t\t\t\t")]),t._v(" "),!t.encrypt&&t.editorPlainText?e("ActionButton",{on:{click:function(e){return t.setEditorModeHtml()}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconHtml",{attrs:{size:20}})]},proxy:!0}],null,!1,811545534)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Enable formatting"))+"\n\t\t\t\t\t")]):t._e(),t._v(" "),t.encrypt||t.editorPlainText?t._e():e("ActionButton",{on:{click:function(e){return t.setEditorModeText()}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("IconClose",{attrs:{size:20}})]},proxy:!0}],null,!1,2888946197)},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Disable formatting"))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionCheckbox",{attrs:{checked:t.requestMdnVal},on:{check:function(e){t.requestMdnVal=!0},uncheck:function(e){t.requestMdnVal=!1}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Request a read receipt"))+"\n\t\t\t\t\t")]),t._v(" "),t.smimeCertificateForCurrentAlias?e("ActionCheckbox",{attrs:{checked:t.wantsSmimeSign},on:{check:function(e){t.wantsSmimeSign=!0},uncheck:function(e){t.wantsSmimeSign=!1}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Sign message with S/MIME"))+"\n\t\t\t\t\t")]):t._e(),t._v(" "),t.smimeCertificateForCurrentAlias?e("ActionCheckbox",{attrs:{checked:t.wantsSmimeEncrypt,disabled:t.encrypt},on:{check:function(e){t.wantsSmimeEncrypt=!0},uncheck:function(e){t.wantsSmimeEncrypt=!1}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Encrypt message with S/MIME"))+"\n\t\t\t\t\t")]):t._e(),t._v(" "),t.mailvelope.available?e("ActionCheckbox",{attrs:{checked:t.encrypt,disabled:t.wantsSmimeEncrypt},on:{change:function(e){t.isActionsOpen=!1},check:function(e){t.encrypt=!0},uncheck:function(e){t.encrypt=!1}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Encrypt message with Mailvelope"))+"\n\t\t\t\t\t")]):t._e()],t._v(" "),t.isMoreActionsOpen?[e("ActionButton",{attrs:{"close-after-click":!1},on:{click:function(e){t.isMoreActionsOpen=!1}},scopedSlots:t._u([{key:"icon",fn:function(){return[e("ChevronLeft",{attrs:{title:t.t("mail","Send later"),size:20}}),t._v("\n\t\t\t\t\t\t\t"+t._s(t.t("mail","Send later"))+"\n\t\t\t\t\t\t")]},proxy:!0}],null,!1,2922837455)}),t._v(" "),e("ActionRadio",{staticClass:"send-action-radio",attrs:{value:void 0,name:"sendLater",checked:!t.sendAtVal},on:{change:function(e){return t.onChangeSendLater(void 0)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Send now"))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionRadio",{staticClass:"send-action-radio send-action-radio--multiline",attrs:{value:t.dateTomorrowMorning,name:"sendLater",checked:t.isSendAtTomorrowMorning},on:{change:function(e){return t.onChangeSendLater(t.dateTomorrowMorning)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Tomorrow morning"))+" - "+t._s(t.convertToLocalDate(t.dateTomorrowMorning))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionRadio",{staticClass:"send-action-radio send-action-radio--multiline",attrs:{value:t.dateTomorrowAfternoon,name:"sendLater",checked:t.isSendAtTomorrowAfternoon},on:{change:function(e){return t.onChangeSendLater(t.dateTomorrowAfternoon)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Tomorrow afternoon"))+" - "+t._s(t.convertToLocalDate(t.dateTomorrowAfternoon))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionRadio",{staticClass:"send-action-radio send-action-radio--multiline",attrs:{value:t.dateMondayMorning,name:"sendLater",checked:t.isSendAtMondayMorning},on:{change:function(e){return t.onChangeSendLater(t.dateMondayMorning)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Monday morning"))+" - "+t._s(t.convertToLocalDate(t.dateMondayMorning))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionRadio",{staticClass:"send-action-radio",attrs:{name:"sendLater",checked:t.isSendAtCustom,value:t.customSendTime},on:{change:function(e){return t.onChangeSendLater(t.customSendTime)}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Custom date and time"))+"\n\t\t\t\t\t")]),t._v(" "),e("ActionInput",{attrs:{"is-native-picker":!0,min:t.dateToday,type:"datetime-local","first-day-of-week":t.firstDayDatetimePicker,use12h:t.showAmPm,formatter:t.formatter,format:"YYYY-MM-DD HH:mm",icon:"","minute-step":5},on:{change:function(e){return t.onChangeSendLater(t.customSendTime)}},model:{value:t.selectedDate,callback:function(e){t.selectedDate=e},expression:"selectedDate"}},[t._v("\n\t\t\t\t\t\t"+t._s(t.t("mail","Enter a date"))+"\n\t\t\t\t\t")])]:t._e()],2),t._v(" "),e("ButtonVue",{attrs:{disabled:!t.canSend,"native-type":"submit",type:"primary","aria-label":t.submitButtonTitle},on:{click:t.onSend},scopedSlots:t._u([{key:"icon",fn:function(){return[e("Send",{attrs:{title:t.submitButtonTitle,size:20}})]},proxy:!0}])},[t._v("\n\t\t\t\t"+t._s(t.submitButtonTitle)+"\n\t\t\t")])],1)])],1)}),[],!1,null,"7aa049b6",null).exports;var Ut=n(1929),Gt=n(90941),Vt=n(67727);class jt extends Error{constructor(t){super(t),this.name=jt.getName(),this.message=t}static getName(){return"AttachmentMissingError"}}var qt=n(16424),Wt=n(58754),Yt=n(72804);const Ht={name:"NewMessageModal",components:{ButtonVue:i.P2,Composer:Ot,EmptyContent:i.SL,Loading:qt.Z,Modal:i.Jc,NcActions:i.O3,NcActionButton:i.Js,MinimizeIcon:Wt.Z},props:{accounts:{type:Array,required:!0}},data:()=>({toolbarElements:void 0,original:void 0,draftsPromise:Promise.resolve(),attachmentsPromise:Promise.resolve(),canSaveDraft:!0,savingDraft:!1,draftSaved:!1,uploadingAttachments:!1,sending:!1,error:void 0,warning:void 0,modalFirstOpen:!0,cookedComposerData:void 0,changed:!1}),computed:{...(0,Lt.Se)(["showMessageComposer"]),modalTitle(){return"outbox"===this.composerMessage.type?(0,s.Iu)("mail","Edit message"):void 0!==this.composerData.draftId?(0,s.Iu)("mail","Draft"):this.composerData.replyTo?(0,s.Iu)("mail","Reply"):this.composerData.forwardFrom?(0,s.Iu)("mail","Forward"):(0,s.Iu)("mail","New message")},composerMessage(){return this.$store.getters.composerMessage},composerData(){var t,e;return null!==(t=null===(e=this.$store.getters.composerMessage)||void 0===e?void 0:e.data)&&void 0!==t?t:{}},forwardedMessages(){var t,e;return null!==(t=null===(e=this.composerMessage)||void 0===e||null===(e=e.options)||void 0===e?void 0:e.forwardedMessages)&&void 0!==t?t:[]}},created(){var t;const e=null===(t=this.composerData)||void 0===t?void 0:t.id;e&&(this.draftsPromise=Promise.resolve(e))},async mounted(){await this.$nextTick(),this.updateCookedComposerData()},methods:{handleShow(t){this.toolbarElements=[t]},toHtml:c.vb,plain:c.Oh,onDraft(t){let{showToast:e=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.composerMessage?(this.changed=!0,this.draftsPromise=this.draftsPromise.then((async a=>{this.savingDraft=!0,this.draftSaved=!1;try{let n;const i=this.getDataForServer(t,!0);if(a)i.id=a,await(0,Yt.XD)(i),this.canSaveDraft=!0,this.draftSaved=!0,n=a;else{const{id:t}=await(0,Yt.DO)(i);i.id=t,await this.$store.dispatch("patchComposerData",{id:t,draftId:i.draftId}),this.canSaveDraft=!0,this.draftSaved=!0,n=t}if(this.$store.commit("setComposerMessageSaved",!0),e&&("outbox"===this.composerMessage.type?(0,o.s$)((0,s.Iu)("mail","Message saved")):(0,o.s$)((0,s.Iu)("mail","Draft saved"))),void 0!==n)return n}catch(t){r.Z.error("Could not save draft",{error:t}),this.canSaveDraft=!1,this.$store.commit("setComposerIndicatorDisabled",!1),e&&("outbox"===this.composerMessage.type?(0,o.x2)((0,s.Iu)("mail","Failed to save message")):(0,o.x2)((0,s.Iu)("mail","Failed to save draft")))}finally{this.savingDraft=!1}})),this.draftsPromise):(r.Z.info("Ignoring draft because there is no message anymore",{data:t}),this.draftsPromise)},getDataForServer(t){var e;return{...t,id:t.id,accountId:t.accountId,body:t.isHtml?t.body.value:(0,c.UK)(t.body).value,editorBody:t.body.value,to:t.to,cc:t.cc,bcc:t.bcc,attachments:t.attachments,aliasId:t.aliasId,inReplyToMessageId:t.inReplyToMessageId,sendAt:t.sendAt,draftId:null===(e=this.composerData)||void 0===e?void 0:e.draftId}},onAttachmentUploading(t,e){this.attachmentsPromise=this.attachmentsPromise.then(t).then((()=>this.onDraft(e))).then((()=>r.Z.debug("attachments uploaded"))).catch((t=>r.Z.error("could not upload attachments",{error:t})))},async onSend(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.Z.debug("sending message",{data:t}),await this.attachmentsPromise,this.uploadingAttachments=!1,this.sending=!0;try{const a=(new Date).getTime();for(const e of t.attachments)e.type||(e.type="local");const n=this.getDataForServer({...t,id:await this.draftsPromise,sendAt:t.sendAt?t.sendAt:Math.floor((a+zt.X1)/1e3)});if(n.sendAt<Math.floor((a+zt.X1)/1e3)&&(n.sendAt=Math.floor((a+zt.X1)/1e3)),!e&&0===t.attachments.length){const e=(0,c.UK)(t.body).value.toLowerCase().split("\n"),a=(0,s.Iu)("mail","attachment").toLowerCase(),n=(0,s.Iu)("mail","attached").toLowerCase();for(const t of e){if(t.startsWith(">")||t.startsWith("--"))break;if(t.includes(a)||t.includes(n))throw new jt}}if(this.composerData.id)0===this.composerData.type?(n.id=this.composerData.id,await this.$store.dispatch("outbox/updateMessage",{message:n,id:this.composerData.id})):(await(0,Yt.XD)(n),n.id=this.composerData.id,await this.$store.dispatch("outbox/enqueueFromDraft",{draftMessage:n,id:this.composerData.id}));else{const{id:t}=await(0,Yt.DO)(n);n.id=t,await this.$store.dispatch("outbox/enqueueFromDraft",{draftMessage:n,id:t})}(!t.sendAt||t.sendAt<Math.floor((a+zt.X1)/1e3))&&this.$store.dispatch("outbox/sendMessageWithUndo",{id:n.id}),n.id&&this.$store.commit("removeMessage",{id:n.id}),await this.$store.dispatch("stopComposerSession"),this.$emit("close")}catch(t){r.Z.error("could not send message",{error:t}),this.error=await(0,Ut.d)(t,{[Gt.Z.getName()]:()=>(0,s.Iu)("mail","No sent mailbox configured. Please pick one in the account settings."),[Vt.Z.getName()]:()=>(0,s.Iu)("mail","You are trying to send to many recipients in To and/or Cc. Consider using Bcc to hide recipient addresses."),default(t){}}),this.warning=await(0,Ut.d)(t,{[jt.getName()]:()=>(0,s.Iu)("mail","You mentioned an attachment. Did you forget to add it?"),default(t){}})}finally{this.sending=!1}const a=this.$store.getters.getAccount(t.accountId);a&&parseInt(this.$route.params.mailboxId,10)===a.sentMailboxId&&setTimeout((()=>{this.$store.dispatch("syncEnvelopes",{mailboxId:a.sentMailboxId,query:"",init:!1})}),500)},async onForceSend(){await this.onSend(this.cookedComposerData,!0)},recipientToRfc822:t=>t.email===t.label||""===t.label||0===t.email.search(/^[a-zA-Z]+:/)?t.email:'"'.concat(t.label,'" <').concat(t.email,">"),async discardDraft(){let t=await this.draftsPromise;const e="outbox"===this.composerMessage.type;e&&(t=this.composerMessage.data.id),await this.$store.dispatch("stopComposerSession");try{e?await this.$store.dispatch("outbox/deleteMessage",{id:t}):(0,Yt.R5)(t),(0,o.s$)((0,s.Iu)("mail","Message discarded"))}catch(t){r.Z.error("Could not discard draft",{error:t}),(0,o.x2)((0,s.Iu)("mail","Could not discard message"))}},convertEditorBody:t=>t.editorBody?t.editorBody:t.body?(0,c.vb)(t.body).value:"",updateCookedComposerData(){this.$refs.composer&&(this.cookedComposerData=this.$refs.composer.getMessageData())},async patchComposerData(t){this.changed=!0,this.updateCookedComposerData(),await this.$store.dispatch("patchComposerData",t)},async onMinimize(){this.modalFirstOpen=!1,await this.$store.dispatch("closeMessageComposer"),!this.$store.getters.composerMessageIsSaved&&this.changed&&await this.onDraft(this.cookedComposerData,{showToast:!0})},async onClose(){this.$store.commit("setComposerIndicatorDisabled",!0),await this.onMinimize(),this.canSaveDraft&&(this.changed&&this.draftSaved||!this.changed)&&(r.Z.debug("Closing composer session due to close button click"),await this.$store.dispatch("stopComposerSession",{restoreOriginalSendAt:!0,moveToImap:this.changed,id:this.composerData.id}))}}};var Kt=n(43434),Qt={};Qt.styleTagTransform=H(),Qt.setAttributes=j(),Qt.insert=G().bind(null,"head"),Qt.domAPI=O(),Qt.insertStyleElement=W(),N()(Kt.Z,Qt),Kt.Z&&Kt.Z.locals&&Kt.Z.locals;const Xt=(0,X.Z)(Ht,(function(){var t=this,e=t._self._c;return t.showMessageComposer?e("Modal",{attrs:{size:"normal",title:t.modalTitle,"additional-trap-elements":t.toolbarElements},on:{close:function(e){"click"===e.type?t.onClose():t.onMinimize()}}},[t.error?e("EmptyContent",{staticClass:"centered-content",attrs:{title:t.t("mail","Error sending your message"),role:"alert"},scopedSlots:t._u([{key:"action",fn:function(){return[e("ButtonVue",{attrs:{type:"tertiary","aria-label":t.t("mail","Go back")},on:{click:function(e){t.error=void 0}}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Go back"))+"\n\t\t\t")]),t._v(" "),e("ButtonVue",{attrs:{type:"tertiary","aria-label":t.t("mail","Retry")},on:{click:t.onSend}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Retry"))+"\n\t\t\t")])]},proxy:!0}],null,!1,1765987980)},[e("p",[t._v(t._s(t.error))])]):t.uploadingAttachments?e("Loading",{attrs:{hint:t.t("mail","Uploading attachments "),role:"alert"}}):t.sending?e("Loading",{attrs:{hint:t.t("mail","Sending "),role:"alert"}}):t.warning?e("EmptyContent",{staticClass:"centered-content",attrs:{title:t.t("mail","Warning sending your message"),role:"alert"},scopedSlots:t._u([{key:"description",fn:function(){return[t._v("\n\t\t\t"+t._s(t.warning)+"\n\t\t")]},proxy:!0},{key:"action",fn:function(){return[e("ButtonVue",{attrs:{type:"tertiary","aria-label":t.t("mail","Go back")},on:{click:function(e){t.warning=void 0}}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Go back"))+"\n\t\t\t")]),t._v(" "),e("ButtonVue",{attrs:{type:"tertiary","aria-label":t.t("mail","Send anyway")},on:{click:t.onForceSend}},[t._v("\n\t\t\t\t"+t._s(t.t("mail","Send anyway"))+"\n\t\t\t")])]},proxy:!0}],null,!1,307678782)}):[e("NcActions",{staticClass:"minimize-button"},[e("NcActionButton",{attrs:{"aria-label":t.t("mail","Minimize composer")},on:{click:t.onMinimize},scopedSlots:t._u([{key:"icon",fn:function(){return[e("MinimizeIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,1222194427)})],1),t._v(" "),e("Composer",{ref:"composer",attrs:{"from-account":t.composerData.accountId,"from-alias":t.composerData.aliasId,to:t.composerData.to,cc:t.composerData.cc,bcc:t.composerData.bcc,subject:t.composerData.subject,"attachments-data":t.composerData.attachments,body:t.composerData.body,"editor-body":t.convertEditorBody(t.composerData),"in-reply-to-message-id":t.composerData.inReplyToMessageId,"reply-to":t.composerData.replyTo,"forward-from":t.composerData.forwardFrom,"send-at":1e3*t.composerData.sendAt,"forwarded-messages":t.forwardedMessages,"can-save-draft":t.canSaveDraft,"saving-draft":t.savingDraft,"draft-saved":t.draftSaved,"smime-sign":t.composerData.smimeSign,"smime-encrypt":t.composerData.smimeEncrypt,"is-first-open":t.modalFirstOpen,"request-mdn":t.composerData.requestMdn,accounts:t.accounts},on:{"update:from-account":function(e){return t.patchComposerData({accountId:e})},"update:from-alias":function(e){return t.patchComposerData({aliasId:e})},"update:to":function(e){return t.patchComposerData({to:e})},"update:cc":function(e){return t.patchComposerData({cc:e})},"update:bcc":function(e){return t.patchComposerData({bcc:e})},"update:subject":function(e){return t.patchComposerData({subject:e})},"update:attachments-data":function(e){return t.patchComposerData({attachments:e})},"update:editor-body":function(e){return t.patchComposerData({editorBody:e})},"update:send-at":function(e){return t.patchComposerData({sendAt:e/1e3})},"update:smime-sign":function(e){return t.patchComposerData({smimeSign:e})},"update:smime-encrypt":function(e){return t.patchComposerData({smimeSign:e})},"update:request-mdn":function(e){return t.patchComposerData({requestMdn:e})},draft:t.onDraft,"discard-draft":t.discardDraft,"upload-attachment":t.onAttachmentUploading,send:t.onSend,"show-toolbar":t.handleShow}})]],2):t._e()}),[],!1,null,"5b0b7460",null).exports}}]);
//# sourceMappingURL=mail.new-message-modal.300be403b0989a9179e1.js.map